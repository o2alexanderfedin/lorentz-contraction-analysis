<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two Particles with Synchronized Laser Detection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            max-width: 1400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            color: #333;
        }
        
        h1 {
            text-align: center;
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .canvas-container {
            position: relative;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            border: 2px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .control-group .value {
            text-align: center;
            font-size: 1.2em;
            color: #764ba2;
            font-weight: bold;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
            width: 100%;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(118, 75, 162, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .info-panel {
            background: linear-gradient(135deg, #f0e6ff 0%, #e6f2ff 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #764ba2;
        }
        
        .info-panel h3 {
            color: #764ba2;
            margin-bottom: 10px;
        }
        
        .info-panel p {
            line-height: 1.6;
            color: #4a5568;
            margin-bottom: 10px;
        }
        
        .phase-indicators {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .phase-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            text-align: center;
        }
        
        .phase-box.active {
            border-color: #764ba2;
            background: linear-gradient(135deg, #f0e6ff 0%, #e6f2ff 100%);
        }
        
        .phase-box h4 {
            color: #764ba2;
            margin-bottom: 5px;
        }
        
        .measurements {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .measurement-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }
        
        .measurement-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .measurement-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #48bb78;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üë• Two Particles with Synchronized Laser Detection</h1>
        <p class="subtitle">P‚ÇÄ and P‚ÇÅ Moving with Identical Acceleration, Separated by Distance D</p>
        
        <div class="canvas-container">
            <canvas id="motionCanvas" width="1200" height="600"></canvas>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="separation">Separation Distance D (units)</label>
                <input type="range" id="separation" min="100" max="400" value="200" step="10">
                <div class="value" id="separationValue">200 units</div>
            </div>
            
            <div class="control-group">
                <label for="acceleration">Acceleration G (m/s¬≤)</label>
                <input type="range" id="acceleration" min="1" max="10" value="5" step="0.5">
                <div class="value" id="accelerationValue">5.0 m/s¬≤</div>
            </div>
            
            <div class="control-group">
                <label for="t1Time">T‚ÇÅ Time (seconds)</label>
                <input type="range" id="t1Time" min="1" max="5" value="2" step="0.1">
                <div class="value" id="t1Value">2.0 s</div>
            </div>
            
            <div class="control-group">
                <label for="t2Time">T‚ÇÇ Time (seconds)</label>
                <input type="range" id="t2Time" min="3" max="10" value="5" step="0.1">
                <div class="value" id="t2Value">5.0 s</div>
            </div>
            
            <div class="control-group">
                <button onclick="startAnimation()">‚ñ∂Ô∏è Start Synchronized Motion</button>
            </div>
        </div>
        
        <div class="measurements">
            <div class="measurement-card">
                <h4>P‚ÇÄ Positions</h4>
                <div id="p0Positions" class="measurement-value">‚Äî</div>
            </div>
            <div class="measurement-card">
                <h4>P‚ÇÅ Positions</h4>
                <div id="p1Positions" class="measurement-value">‚Äî</div>
            </div>
            <div class="measurement-card">
                <h4>Current Separation</h4>
                <div id="currentSeparation" class="measurement-value">‚Äî</div>
            </div>
            <div class="measurement-card">
                <h4>Phase</h4>
                <div id="currentPhase" class="measurement-value">‚Äî</div>
            </div>
        </div>
        
        <div class="phase-indicators">
            <div class="phase-box" id="phase-t0">
                <h4>T‚ÇÄ: Start Signal</h4>
                <p>Both particles triggered</p>
            </div>
            <div class="phase-box" id="phase-t1">
                <h4>T‚ÇÅ: End Acceleration</h4>
                <p>Constant velocity begins</p>
            </div>
            <div class="phase-box" id="phase-t2">
                <h4>T‚ÇÇ: Detection</h4>
                <p>Final positions recorded</p>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>üìä Synchronized Two-Particle System</h3>
            <p>
                <strong>Key Principle:</strong> Two particles P‚ÇÄ and P‚ÇÅ start separated by distance D and undergo identical acceleration profiles.
                Each particle has its own set of three laser detectors that track its motion through all phases.
            </p>
            <p>
                <strong>P‚ÇÄ Laser Detectors:</strong> Located at X‚ÇÄ, X‚ÇÅ, and X‚ÇÇ
            </p>
            <p>
                <strong>P‚ÇÅ Laser Detectors:</strong> Located at X‚ÇÄ+D, X‚ÇÅ+D, and X‚ÇÇ+D
            </p>
            <p>
                <strong>Important Result:</strong> The separation D remains constant throughout all phases (T‚ÇÄ‚ÜíT‚ÇÅ‚ÜíT‚ÇÇ) when measured
                in the observer's frame, demonstrating that synchronized acceleration preserves relative distances.
            </p>
        </div>
    </div>
    
    <script>
        // Copy the Particle, LaserDetector, and ParticleSystem classes from particle_laser_trigger.html
        
        class Particle {
            constructor(name, x0, color = '#764ba2') {
                this.name = name;
                this.x0 = x0;
                this.x = x0;
                this.y = 400;
                this.color = color;
                this.isActive = false;
                this.velocity = 0;
            }
            
            updatePosition(x) {
                this.x = x;
            }
            
            draw(ctx, yOffset = 0) {
                const y = this.y + yOffset;
                
                // Draw particle
                ctx.fillStyle = this.isActive ? this.color : '#cbd5e0';
                ctx.beginPath();
                ctx.arc(this.x, y, 15, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = this.isActive ? '#553c9a' : '#a0aec0';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Label
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(this.name, this.x, y + 5);
                
                // Motion arrow if moving
                if (this.isActive && this.x > this.x0 + 10) {
                    ctx.strokeStyle = '#48bb78';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(this.x + 20, y);
                    ctx.lineTo(this.x + 60, y);
                    ctx.stroke();
                    
                    // Arrowhead
                    ctx.beginPath();
                    ctx.moveTo(this.x + 60, y);
                    ctx.lineTo(this.x + 50, y - 8);
                    ctx.lineTo(this.x + 50, y + 8);
                    ctx.closePath();
                    ctx.fillStyle = '#48bb78';
                    ctx.fill();
                }
            }
        }
        
        class LaserDetector {
            constructor(x, label, color, detectionRange = 20) {
                this.x = x;
                this.y = 100;
                this.label = label;
                this.color = color;
                this.detectionRange = detectionRange;
                this.isDetecting = false;
            }
            
            checkDetection(particleX) {
                this.isDetecting = Math.abs(particleX - this.x) < this.detectionRange;
                return this.isDetecting;
            }
            
            draw(ctx, yOffset = 0) {
                const y = this.y + yOffset;
                
                // Laser emitter with blinking effect
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.isDetecting ? 1 : 0.4;
                ctx.fillRect(this.x - 15, y - 30, 30, 25);
                
                // Laser beam (vertical) with blinking
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 3;
                ctx.setLineDash([10, 5]);
                ctx.globalAlpha = this.isDetecting ? 0.8 : 0.2;
                ctx.beginPath();
                ctx.moveTo(this.x, y);
                ctx.lineTo(this.x, 500);
                ctx.stroke();
                ctx.globalAlpha = 1;
                ctx.setLineDash([]);
                
                // Add glow effect when detecting
                if (this.isDetecting) {
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = this.color;
                    ctx.fillStyle = this.color;
                    ctx.globalAlpha = 0.3;
                    ctx.beginPath();
                    ctx.arc(this.x, y - 15, 25, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                    ctx.globalAlpha = 1;
                }
                
                // Label
                ctx.fillStyle = '#2d3748';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(this.label, this.x, y - 40);
            }
        }
        
        class ParticleSystem {
            constructor(particle, lasers = [], yOffset = 0) {
                this.particle = particle;
                this.lasers = lasers;
                this.scale = 20; // Reduced scale for two-particle view
                this.elapsed = 0;
                this.phase = 'idle';
                this.G = 5;
                this.T1 = 2;
                this.T2 = 5;
                this.isRunning = false;
                this.yOffset = yOffset;
            }
            
            reset() {
                this.elapsed = 0;
                this.phase = 'idle';
                this.particle.x = this.particle.x0;
                this.particle.isActive = false;
                this.particle.velocity = 0;
                this.isRunning = false;
            }
            
            start(G, T1, T2) {
                this.G = G;
                this.T1 = T1;
                this.T2 = T2;
                this.elapsed = 0;
                this.isRunning = true;
                this.particle.isActive = true;
            }
            
            step(deltaTime) {
                if (!this.isRunning) return;
                
                this.elapsed += deltaTime;
                let x, velocity;
                
                if (this.elapsed < this.T1) {
                    // Phase 1: Acceleration
                    this.phase = 'accelerating';
                    x = this.particle.x0 + 0.5 * this.G * this.elapsed * this.elapsed * this.scale;
                    velocity = this.G * this.elapsed;
                } else if (this.elapsed < this.T2) {
                    // Phase 2: Uniform motion
                    this.phase = 'uniform';
                    const V1 = this.G * this.T1;
                    const X1 = this.particle.x0 + 0.5 * this.G * this.T1 * this.T1 * this.scale;
                    x = X1 + V1 * (this.elapsed - this.T1) * this.scale;
                    velocity = V1;
                } else {
                    // Phase 3: Detection complete
                    this.phase = 'detected';
                    const V1 = this.G * this.T1;
                    const X1 = this.particle.x0 + 0.5 * this.G * this.T1 * this.T1 * this.scale;
                    x = Math.min(X1 + V1 * (this.T2 - this.T1) * this.scale, 1100);
                    velocity = V1;
                    
                    // Stop after detection
                    if (this.elapsed > this.T2 + 1) {
                        this.isRunning = false;
                    }
                }
                
                this.particle.updatePosition(x);
                this.particle.velocity = velocity;
                
                // Update laser detection states
                this.lasers.forEach(laser => {
                    laser.checkDetection(this.particle.x);
                });
                
                return this.phase;
            }
            
            draw(ctx) {
                // Draw all lasers
                this.lasers.forEach(laser => laser.draw(ctx, this.yOffset));
                
                // Draw particle
                this.particle.draw(ctx, this.yOffset);
                
                // Draw motion trail if particle is moving
                if (this.particle.isActive && this.particle.x > this.particle.x0) {
                    ctx.strokeStyle = this.particle.color + '40';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 3]);
                    ctx.beginPath();
                    ctx.moveTo(this.particle.x0, this.particle.y + this.yOffset);
                    ctx.lineTo(this.particle.x - 15, this.particle.y + this.yOffset);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            }
        }
        
        // Canvas setup
        const canvas = document.getElementById('motionCanvas');
        const ctx = canvas.getContext('2d');
        
        let animationId = null;
        let startTime = null;
        let lastTime = 0;
        
        // Physics parameters
        let G = 5;
        let T1 = 2;
        let T2 = 5;
        let D = 200; // Separation distance
        let X0_P0 = 100; // P0 initial position
        
        // Create two particle systems
        const particleP0 = new Particle('P‚ÇÄ', X0_P0, '#4299e1');
        const particleP1 = new Particle('P‚ÇÅ', X0_P0 + D, '#e53e3e');
        
        // Calculate positions for lasers
        function calculateLaserPositions(x0, G, T1, T2) {
            const scale = 20;
            const X1 = x0 + 0.5 * G * T1 * T1 * scale;
            const V1 = G * T1;
            const X2 = Math.min(X1 + V1 * (T2 - T1) * scale, 1100);
            return { X0: x0, X1, X2 };
        }
        
        // Create laser systems for each particle
        let positionsP0 = calculateLaserPositions(X0_P0, G, T1, T2);
        let positionsP1 = calculateLaserPositions(X0_P0 + D, G, T1, T2);
        
        const lasersP0 = [
            new LaserDetector(positionsP0.X0, 'P‚ÇÄ-T‚ÇÄ', '#48bb78'),
            new LaserDetector(positionsP0.X1, 'P‚ÇÄ-T‚ÇÅ', '#f6ad55'),
            new LaserDetector(positionsP0.X2, 'P‚ÇÄ-T‚ÇÇ', '#f56565')
        ];
        
        const lasersP1 = [
            new LaserDetector(positionsP1.X0, 'P‚ÇÅ-T‚ÇÄ', '#48bb78'),
            new LaserDetector(positionsP1.X1, 'P‚ÇÅ-T‚ÇÅ', '#f6ad55'),
            new LaserDetector(positionsP1.X2, 'P‚ÇÅ-T‚ÇÇ', '#f56565')
        ];
        
        // Create particle systems with different y offsets
        const systemP0 = new ParticleSystem(particleP0, lasersP0, -50);
        const systemP1 = new ParticleSystem(particleP1, lasersP1, 50);
        
        function drawStaticElements() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw coordinate systems for both particles
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            
            // P0 axis
            ctx.beginPath();
            ctx.moveTo(50, 350);
            ctx.lineTo(1150, 350);
            ctx.stroke();
            
            // P1 axis
            ctx.beginPath();
            ctx.moveTo(50, 450);
            ctx.lineTo(1150, 450);
            ctx.stroke();
            
            // Draw position markers
            ctx.fillStyle = '#4a5568';
            ctx.font = '11px Arial';
            ctx.textAlign = 'center';
            
            // P0 markers
            positionsP0 = calculateLaserPositions(X0_P0, G, T1, T2);
            ctx.fillText('X‚ÇÄ', positionsP0.X0, 370);
            ctx.fillText('X‚ÇÅ', positionsP0.X1, 370);
            ctx.fillText('X‚ÇÇ', positionsP0.X2, 370);
            
            // P1 markers
            positionsP1 = calculateLaserPositions(X0_P0 + D, G, T1, T2);
            ctx.fillText('X‚ÇÄ+D', positionsP1.X0, 470);
            ctx.fillText('X‚ÇÅ+D', positionsP1.X1, 470);
            ctx.fillText('X‚ÇÇ+D', positionsP1.X2, 470);
            
            // Draw separation line
            ctx.strokeStyle = '#9f7aea';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(particleP0.x, 350);
            ctx.lineTo(particleP1.x, 450);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw separation label
            const midX = (particleP0.x + particleP1.x) / 2;
            const midY = 400;
            ctx.fillStyle = '#9f7aea';
            ctx.font = 'bold 14px Arial';
            ctx.fillText(`D = ${Math.abs(particleP1.x - particleP0.x).toFixed(0)}`, midX, midY);
        }
        
        function animate(timestamp) {
            if (!startTime) {
                startTime = timestamp;
                lastTime = timestamp;
            }
            
            const deltaTime = (timestamp - lastTime) / 1000;
            lastTime = timestamp;
            
            drawStaticElements();
            
            // Step both systems simultaneously
            const phaseP0 = systemP0.step(deltaTime);
            const phaseP1 = systemP1.step(deltaTime);
            
            // Draw both systems
            systemP0.draw(ctx);
            systemP1.draw(ctx);
            
            // Update phase indicators
            document.querySelectorAll('.phase-box').forEach(box => box.classList.remove('active'));
            
            switch(phaseP0) {
                case 'accelerating':
                    document.getElementById('phase-t0').classList.add('active');
                    document.getElementById('currentPhase').textContent = 'Accelerating';
                    break;
                case 'uniform':
                    document.getElementById('phase-t1').classList.add('active');
                    document.getElementById('currentPhase').textContent = 'Uniform Motion';
                    break;
                case 'detected':
                    document.getElementById('phase-t2').classList.add('active');
                    document.getElementById('currentPhase').textContent = 'Detected';
                    break;
            }
            
            // Update measurements
            document.getElementById('p0Positions').textContent = `${(particleP0.x - X0_P0).toFixed(0)} units`;
            document.getElementById('p1Positions').textContent = `${(particleP1.x - X0_P0 - D).toFixed(0)} units`;
            document.getElementById('currentSeparation').textContent = `${Math.abs(particleP1.x - particleP0.x).toFixed(0)} units`;
            
            // Continue animation if either system is running
            if (systemP0.isRunning || systemP1.isRunning) {
                animationId = requestAnimationFrame(animate);
            } else if (systemP0.elapsed > T2) {
                setTimeout(() => {
                    systemP0.reset();
                    systemP1.reset();
                    drawStaticElements();
                    systemP0.draw(ctx);
                    systemP1.draw(ctx);
                }, 1000);
            }
        }
        
        function startAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            startTime = null;
            lastTime = 0;
            
            // Get current parameters
            G = parseFloat(document.getElementById('acceleration').value);
            T1 = parseFloat(document.getElementById('t1Time').value);
            T2 = parseFloat(document.getElementById('t2Time').value);
            D = parseFloat(document.getElementById('separation').value);
            
            // Update particle initial positions
            particleP0.x0 = X0_P0;
            particleP1.x0 = X0_P0 + D;
            
            // Update laser positions
            positionsP0 = calculateLaserPositions(X0_P0, G, T1, T2);
            positionsP1 = calculateLaserPositions(X0_P0 + D, G, T1, T2);
            
            lasersP0[0].x = positionsP0.X0;
            lasersP0[1].x = positionsP0.X1;
            lasersP0[2].x = positionsP0.X2;
            
            lasersP1[0].x = positionsP1.X0;
            lasersP1[1].x = positionsP1.X1;
            lasersP1[2].x = positionsP1.X2;
            
            // Start both systems
            systemP0.start(G, T1, T2);
            systemP1.start(G, T1, T2);
            
            animationId = requestAnimationFrame(animate);
        }
        
        // Event listeners
        document.getElementById('separation').addEventListener('input', (e) => {
            document.getElementById('separationValue').textContent = e.target.value + ' units';
            D = parseFloat(e.target.value);
            particleP1.x0 = X0_P0 + D;
            particleP1.x = X0_P0 + D;
            
            // Update laser positions
            positionsP1 = calculateLaserPositions(X0_P0 + D, G, T1, T2);
            lasersP1[0].x = positionsP1.X0;
            lasersP1[1].x = positionsP1.X1;
            lasersP1[2].x = positionsP1.X2;
            
            drawStaticElements();
            systemP0.draw(ctx);
            systemP1.draw(ctx);
        });
        
        document.getElementById('acceleration').addEventListener('input', (e) => {
            document.getElementById('accelerationValue').textContent = parseFloat(e.target.value).toFixed(1) + ' m/s¬≤';
            G = parseFloat(e.target.value);
        });
        
        document.getElementById('t1Time').addEventListener('input', (e) => {
            document.getElementById('t1Value').textContent = parseFloat(e.target.value).toFixed(1) + ' s';
            T1 = parseFloat(e.target.value);
            const t2Slider = document.getElementById('t2Time');
            if (parseFloat(t2Slider.value) <= T1) {
                t2Slider.value = T1 + 1;
                document.getElementById('t2Value').textContent = (T1 + 1).toFixed(1) + ' s';
                T2 = T1 + 1;
            }
        });
        
        document.getElementById('t2Time').addEventListener('input', (e) => {
            const newT2 = parseFloat(e.target.value);
            if (newT2 > T1) {
                document.getElementById('t2Value').textContent = newT2.toFixed(1) + ' s';
                T2 = newT2;
            } else {
                e.target.value = T1 + 1;
                document.getElementById('t2Value').textContent = (T1 + 1).toFixed(1) + ' s';
                T2 = T1 + 1;
            }
        });
        
        // Initial draw
        drawStaticElements();
        systemP0.draw(ctx);
        systemP1.draw(ctx);
    </script>
</body>
</html>